<!-- C√≥digo base del usuario + integraciones de lectura de c√≥digos y biom√©trico + conexi√≥n a BD -->
<!-- Nota: no se cambia ning√∫n nombre de personajes ni de im√°genes -->

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wiki ‚Äî My Hero Academia</title>
  <style>
    :root{--bg:#f6f7fb;--card:#ffffff;--muted:#6b7280;--accent:#0ea5a4}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{font-size:22px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    input[type=search]{padding:10px;border-radius:8px;border:1px solid #ddd;min-width:220px}
    select,button{padding:8px 10px;border-radius:8px;border:1px solid #ddd;background:white;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:16px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(16,24,40,0.06);display:flex;gap:12px;align-items:flex-start}
    .thumb{width:72px;height:72px;border-radius:8px;object-fit:cover;background:#efefef;flex-shrink:0}
    .meta{flex:1}
    .heroName{font-weight:700}
    .real{color:var(--muted);font-size:13px}
    .small{font-size:13px;color:var(--muted);margin-top:6px}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #eee;font-size:12px;background:#fbfdfe}
    .section-title{margin:18px 0 8px;font-size:18px}

    /* modal */
    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:16px}
    .modal{background:var(--card);width:900px;max-width:98%;border-radius:10px;padding:18px;display:flex;gap:16px}
    .modal img{width:220px;height:220px;object-fit:cover;border-radius:8px}
    .modal .info{flex:1}
    .modal h2{margin:0 0 6px 0}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .close{background:#fff;border:1px solid #ddd;padding:6px 8px;border-radius:8px;cursor:pointer}

    /* Botones especiales */
    .tools{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .tools button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Wiki ‚Äî My Hero Academia</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Buscar nombre, alias, quirk, afiliaci√≥n..." />
        <select id="groupFilter">
          <option value="all">Todos</option>
          <option value="pro">H√©roes Profesionales</option>
          <option value="students">Estudiantes (U.A.)</option>
          <option value="villains">Villanos</option>
        </select>
        <button id="clear">Limpiar</button>
      </div>
    </header>

    <!-- Botones de activaci√≥n ‚Üí BD -->
    <div class="tools">
      <button onclick="activarBarras()">üì∑ Activar C√≥digo de Barras</button>
      <button onclick="activarQR()">üî≥ Activar QR</button>
      <button onclick="activarBio()">üñê Activar Biom√©trico</button>
    </div>

    <div>
      <div class="section-title">Resultados</div>
      <div id="grid" class="grid" role="list"></div>
    </div>
  </div>

  <!-- modal -->
  <div id="modalBack" class="modal-back" role="dialog" aria-modal="true">
    <div class="modal">
      <img id="mImage" src="" alt="imagen" />
      <div class="info">
        <h2 id="mTitle"></h2>
        <div class="tags" id="mTags"></div>
        <p id="mOrigin" class="small"></p>
        <p id="mDesc" style="margin-top:10px;line-height:1.4"></p>
        <div style="margin-top:10px"><button class="close" id="mClose">Cerrar</button></div>
      </div>
    </div>
  </div>

  <!-- QR Lib -->
  <script src="https://unpkg.com/html5-qrcode"></script>

  <script>
    /**************************************
     *     1. DATOS ORIGINALES (NO CAMBIADOS)
     **************************************/
   const HEROES = [
      // ---- H√âROES PROFESIONALES (m√°s varios) ----
      { id: 1001, name: 'Toshinori Yagi', heroName: 'All Might', quirk: 'One For All', group: 'pro', affiliation: 'S√≠mbolo de la Paz (retirado)', origin: 'Legendario h√©roe y mentor.', description: 'Portador del One For All, s√≠mbolo de esperanza para la sociedad.', image: 'allmight.jpg' },
      { id: 1002, name: 'Enji Todoroki', heroName: 'Endeavor', quirk: 'Hellflame', group: 'pro', affiliation: 'H√©roe N¬∫1', origin: 'H√©roe profesional de primera l√≠nea.', description: 'Control absoluto del fuego, gran determinaci√≥n para superar sus fallos del pasado.', image: 'endeavor.jpg' },
      { id: 1003, name: 'Keigo Takami', heroName: 'Hawks', quirk: 'Fierce Wings', group: 'pro', affiliation: 'H√©roe Pro', origin: 'Reciente h√©roe top.', description: 'Extremadamente veloz y con habilidades de reconocimiento e infiltraci√≥n.', image: 'hawks.jpg' },
      { id: 1004, name: 'Shota Aizawa', heroName: 'Eraser Head', quirk: 'Erasure', group: 'pro', affiliation: 'Docente U.A. / H√©roe Pro', origin: 'Profesor de la U.A., especialista t√°ctico.', description: 'Puede anular quirks con la vista; instructor estricto y eficaz.', image: 'aizawa.jpg' },
      { id: 1005, name: 'Rumi Usagiyama', heroName: 'Mirko', quirk: 'Rabbit', group: 'pro', affiliation: 'H√©roe Pro', origin: 'Hero√≠na combativa.', description: 'Agilidad y fuerza extraordinarias; conocida por su ferocidad en combate cuerpo a cuerpo.', image: 'mirko.jpg' },
      { id: 1006, name: 'Nejire Hado', heroName: 'Nejire-chan', quirk: 'Wave Motion', group: 'pro', affiliation: 'Big Three', origin: 'Una de las tres principales estudiantes/profesionales emergentes.', description: 'Genera poderosas ondas de choque.', image: 'nejire.jpg' },
      { id: 1007, name: 'Mirio Togata', heroName: 'Lemillion', quirk: 'Permeation', group: 'pro', affiliation: 'Ex-U.A. / Big Three', origin: 'Heroico y carism√°tico.', description: 'Puede volverse intangible y atravesar objetos; muy valiente.', image: 'mirio.jpg' },
      { id: 1008, name: 'Tsunagu Hakamada', heroName: 'Best Jeanist', quirk: 'Fiber Master', group: 'pro', affiliation: 'H√©roe Pro', origin: 'Respetado dise√±ador-h√©roe.', description: 'Manipula fibras para control y defensa.', image: 'bestjeanist.jpg' },
      { id: 1009, name: 'Yu Takeyama', heroName: 'Mt. Lady', quirk: 'Gigantification', group: 'pro', affiliation: 'H√©roe Pro', origin: 'Popular entre la prensa.', description: 'Puede aumentar su tama√±o; famosa por intervenciones p√∫blicas.', image: 'mtlady.jpg' },
      { id: 1010, name: 'Shinya Kamihara', heroName: 'Edgeshot', quirk: 'Foldabody', group: 'pro', affiliation: 'H√©roe Pro', origin: 'Especialista en ataques sorpresa.', description: 'Habilidad para plegar su cuerpo y moverse como una cuchilla.', image: 'edgesshot.jpg' },
      
      // ---- U.A. Estudiantes (ejemplos) ----
      { id: 2001, name: 'Izuku Midoriya', heroName: 'Deku', quirk: 'One For All', group: 'students', affiliation: 'U.A. 1-A', origin: 'Sucesor de All Might', description: 'Protagonista y analista.', image: 'deku.jpg' },
      { id: 2002, name: 'Katsuki Bakug≈ç', heroName: 'Dynamight', quirk: 'Explosion', group: 'students', affiliation: 'U.A. 1-A', origin: 'Rival de Deku', description: 'Talento natural para combate ofensivo.', image: 'bakugo.jpg' },
      { id: 2003, name: 'Shoto Todoroki', heroName: 'Shoto', quirk: 'Half-Cold Half-Hot', group: 'students', affiliation: 'U.A. 1-A', origin: 'Hijo de Endeavor', description: 'Controla fuego y hielo.', image: 'todoroki.jpg' },

      // ---- VILLANOS (Liga de Villanos y aliados) ----
      { id: 3001, name: 'Tenko Shimura', villianName: 'Tomura Shigaraki', quirk: 'Decay', group: 'villains', affiliation: 'Liga de Villanos', origin: 'Discipulo de AFO', description: 'L√≠der de la Liga; desintegra lo que toca con contacto directo.', image: 'shigaraki.jpg' },
      { id: 3002, name: 'All For One', villianName: 'All For One', quirk: 'All For One', group: 'villains', affiliation: 'N√∫cleo del poder', origin: 'Antiguo enemigo de la sociedad de h√©roes', description: 'Capacidad para robar y otorgar quirks.', image: 'afo.jpg' },
      { id: 3003, name: 'Dabi', villianName: 'Dabi', quirk: 'Blueflame', group: 'villains', affiliation: 'Liga de Villanos', origin: 'Identidad familiar complicada', description: 'Llamas azules de alta temperatura.', image: 'dabi.jpg' },
      { id: 3004, name: 'Himiko Toga', villianName: 'Toga', quirk: 'Transform', group: 'villains', affiliation: 'Liga de Villanos', origin: 'Obsesiva y voluble', description: 'Puede imitar a otros tras ingerir su sangre.', image: 'toga.jpg' },
      { id: 3005, name: 'Jin Bubaigawara', villianName: 'Twice', quirk: 'Doble', group: 'villains', affiliation: 'Liga de Villanos', origin: 'Miembro leal', description: 'Produce √°cido corrosivo para el combate.', image: 'Twice.jpg' },
      { id: 3006, name: 'Kurogiri', villianName: 'Kurogiri', quirk: 'Warp Gate', group: 'villains', affiliation: 'Liga de Villanos / Operativo', origin: 'Control de portales', description: 'Genera nebulosas que sirven de portales de teletransporte.', image: 'kurogiri.jpg' },
      { id: 3007, name: 'Shuichi Iguchi', villianName: 'Spinner (alias similar)', quirk: 'Lizard', group: 'villains', affiliation: 'Liga de Villanos', origin: 'Seguidor de dise√±os arcaicos', description: 'Apariencia reptiliana y agilidad.', image: 'spinner.jpg' },
      { id: 3008, name: 'Nomu', villianName: 'Nomu', quirk: 'Multi-Quirk', group: 'villains', affiliation: 'Creaci√≥n de villanos', origin: 'Bio-modificado', description: 'Criaturas creadas para el combate con quirks m√∫ltiples.', image: 'nomu.jpg' },
      { id: 3009, name: 'Gigantomachia', villianName: 'Gigantomachia', quirk: 'Titanic Strength', group: 'villains', affiliation: 'Aliado de AFO', origin: 'Gigante imparable', description: 'Fuerza y resistencia colosales; pr√°cticamente indestructible.', image: 'giga.jpg' }
    ];

    /**************************************
     *     2. SISTEMA DE GUARDADO EN BD
     **************************************/

    function guardarEnBD(valor, tipo){
      // tipo = "barras" | "qr" | "bio"
      fetch('registrar.php',{
        method:'POST',
        headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body: `valor=${encodeURIComponent(valor)}&tipo=${encodeURIComponent(tipo)}`
      })
      .then(r=>r.text())
      .then(msg=>alert(msg))
      .catch(()=>alert('Error al conectar con el servidor'));
    }

    /**************************************
     *     3. C√ìDIGO DE BARRAS
     **************************************/
    function activarBarras(){
      alert('Escanea el c√≥digo de barras');
      let buffer = "";
      document.addEventListener('keydown', leer);

      function leer(e){
        if(e.key === 'Enter'){
          guardarEnBD(buffer, 'barras');
          document.removeEventListener('keydown', leer);
          buffer = "";
        } else buffer += e.key;
      }
    }

    /**************************************
     *     4. LECTURA QR
     **************************************/
    function activarQR(){
      const qrBox = document.createElement('div');
      qrBox.id = 'qr-reader-temp';
      qrBox.style = 'width:300px;margin:20px auto;';
      document.body.appendChild(qrBox);

      const qr = new Html5Qrcode('qr-reader-temp');
      qr.start({ facingMode: "environment" }, { fps:10, qrbox:250 }, val=>{
        guardarEnBD(val, 'qr');
        qr.stop();
        qrBox.remove();
      });
    }

    /**************************************
     *     5. BIOM√âTRICO (SIMULADO ‚Üí REAL EN PHP)
     **************************************/
    function activarBio(){
      alert('Conecta el lector biom√©trico.');
      fetch('biometrico.php')
        .then(r=>r.text())
        .then(res=>{
          guardarEnBD(res, 'bio');
        });
    }


    /**************************************
     *     6. FILTROS + RENDER (NO SE MODIFICA)
     **************************************/
    const grid = document.getElementById('grid');
    const search = document.getElementById('search');
    const groupFilter = document.getElementById('groupFilter');
    const clearBtn = document.getElementById('clear');

    function render(list){
      grid.innerHTML = '';
      if(!list.length){grid.innerHTML='<div style="grid-column:1/-1;padding:20px;text-align:center;color:#6b7280">No hay resultados</div>';return}
      for(const h of list){
        const isVillain = h.group==='villains';
        const name = isVillain ? h.villianName : h.heroName;
        const el = document.createElement('article');
        el.className='card';
        el.innerHTML = `
          <img class="thumb" src="${h.image}" alt="${name}">
          <div class="meta">
            <div class="heroName">${name} <span class="real">‚Äî ${h.name}</span></div>
            <div class="small">Quirk: <strong>${h.quirk}</strong></div>
            <div class="small">Afiliaci√≥n: <span class="badge">${h.affiliation}</span></div>
            <div style="margin-top:8px"><button data-id="${h.id}" class="viewBtn">Ver ficha</button></div>
          </div>`;
        grid.appendChild(el);
      }
      document.querySelectorAll('.viewBtn')
        .forEach(btn=>btn.onclick=()=>openModal(parseInt(btn.dataset.id)));
    }

    function filterAndRender(){
      const q = search.value.toLowerCase();
      const grp = groupFilter.value;
      let r = HEROES.filter(h=>{
        if(grp!=='all' && h.group!==grp) return false;
        if(!q) return true;
        const name = h.group==='villains'?h.villianName:h.heroName;
        return (h.name + ' ' + name + ' ' + h.quirk + ' ' + h.affiliation).toLowerCase().includes(q);
      });
      r.sort((a,b)=>{
        const na = a.group==='villains'?a.villianName:a.heroName;
        const nb = b.group==='villains'?b.villianName:b.heroName;
        return na.localeCompare(nb);
      });
      render(r);
    }

    search.addEventListener('input',filterAndRender);
    groupFilter.addEventListener('change',filterAndRender);
    clearBtn.addEventListener('click',()=>{search.value='';groupFilter.value='all';filterAndRender()});

    // Modal
    const modalBack=document.getElementById('modalBack');
    const mImage=document.getElementById('mImage');
    const mTitle=document.getElementById('mTitle');
    const mTags=document.getElementById('mTags');
    const mOrigin=document.getElementById('mOrigin');
    const mDesc=document.getElementById('mDesc');
    document.getElementById('mClose').onclick=closeModal;
    modalBack.onclick=e=>{ if(e.target===modalBack) closeModal(); }

    function openModal(id){
      const h = HEROES.find(x=>x.id===id);
      const name = h.group==='villains'?h.villianName:h.heroName;
      mImage.src=h.image;
      mTitle.textContent=`${name} ‚Äî ${h.name}`;
      mTags.innerHTML='';
      mTags.innerHTML+=`<span class='badge'>${h.group}</span>`;
      mTags.innerHTML+=`<span class='badge'>${h.quirk}</span>`;
      mOrigin.textContent=`Afiliaci√≥n: ${h.affiliation} ‚Äî Origen: ${h.origin}`;
      mDesc.textContent=h.description;
      modalBack.style.display='flex';
    }
    function closeModal(){ modalBack.style.display='none'; }

    filterAndRender();
  </script>
</body>
</html>
